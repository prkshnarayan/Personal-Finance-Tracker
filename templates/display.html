<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Transaction</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="/static/css/add.css">
</head>
<body>

<div class="container">
    <h2>Add Transaction</h2>

    <form id="transaction-form" method="post" action="{% url 'home' %}">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Add Transaction</button>
    </form>

    <!-- Summary Section -->
    <div class="summary">
        <div class="summary-box" id="income">Income: ₹ {{ income }}</div>
        <div class="summary-box" id="expense">Expense: ₹ {{ expense }}</div>
        <div class="summary-box" id="balance">Balance: ₹ {{ balance }}</div>
    </div>

    <h3>All Transactions</h3>
    <ul id="transaction-list">
        {% for t in transactions %}
            <li>{{ t.Date }} :  {{ t.Title }}  -  {{ t.Type }}  -  ₹ {{ t.Amount }}  -  {{ t.Category }}</li>
        {% empty %}
            <li>No transactions yet.</li>
        {% endfor %}
    </ul>
</div>

<script>
$(document).ready(function() {
    $('#transaction-form').on('submit', function(e) {
        e.preventDefault();
        $.ajax({
            type: 'POST',
            url: "{% url 'home' %}",
            data: $(this).serialize(),
            success: function(response) {
                $('#income').text('Income: $' + response.income);
                $('#expense').text('Expense: $' + response.expense);
                $('#balance').text('Balance: $' + response.balance);

                let t = response.new_transaction;
                $('#transaction-list').prepend(`<li>${t.Date}: ${t.Title} - ${t.Type} - $${t.Amount} - ${t.Category}</li>`);

                $('#transaction-form')[0].reset();
            },
            error: function() {
                alert('Error adding transaction.');
            }
        });
    });
});
</script>

</body>
</html>
